// Code generated by protokitgo. DO NOT EDIT.
// source: common_command/common_cmd.proto

package common_command

import (
	// fixed import by protokitgo
	"context"
	"fmt"
	"math"
	"reflect"
	"strings"

	"bitbucket.org/funplus/ark"
	"bitbucket.org/funplus/sandwich/base/net/link"
	"bitbucket.org/funplus/sandwich/client"
	"bitbucket.org/funplus/sandwich/current"
	"bitbucket.org/funplus/sandwich/message"
	"bitbucket.org/funplus/sandwich/metadata"
	"bitbucket.org/funplus/sandwich/protocol/netutils"
	"bitbucket.org/funplus/sandwich/router"
	"github.com/sandwich-go/boost/validator"
	serror "github.com/sandwich-go/boost/xerror"
	"google.golang.org/protobuf/proto"

	_ "google.golang.org/genproto/googleapis/api/annotations"
	protobufEmpty "google.golang.org/protobuf/types/known/emptypb"
	// dynamic import
)

// Reference imports to suppress errors if they are not otherwise used.
var _ ark.Context
var _ client.Client
var _ router.Router
var _ = current.NewContext(context.Background())
var _ serror.Error
var _ link.Session
var _ message.Message
var _ netutils.RawPacket
var _ ark.Context
var _ context.Context
var _ = fmt.Errorf
var _ = math.Inf
var _ proto.MarshalOptions
var _ reflect.Type
var _ strings.Builder
var _ metadata.MD
var _ protobufEmpty.Empty
var _ validator.Validator

type RpcClientCommonCmd interface {
	Ping(context.Context, *netutils.Ping, ...client.CallOption) (*netutils.PingAck, error)
}

type proxyRpcClientCommonCmd struct {
	c                  client.Client
	urinetutilsPing    string
	urinetutilsPingAck string
	uriErrType         string
	usingGRPC          bool
}

// Deprecated: use NewRpcClientCommonCmd
var NewClientCommonCmdService = NewRpcClientCommonCmd

func NewRpcClientCommonCmd(c client.Client) RpcClientCommonCmd {
	cc := &proxyRpcClientCommonCmd{c: c}
	uri := c.Codec()
	cc.urinetutilsPing = uri.URI(new(netutils.Ping))
	cc.urinetutilsPingAck = uri.URI(new(netutils.PingAck))
	cc.uriErrType = uri.URI(&netutils.ErrorResponse{})
	if v, ok := c.(interface {
		UsingGRPC() bool
	}); ok {
		cc.usingGRPC = v.UsingGRPC()
	}
	return cc
}
func (c *proxyRpcClientCommonCmd) Ping(ctx context.Context, in *netutils.Ping, opts ...client.CallOption) (*netutils.PingAck, error) {

	if c.usingGRPC {
		ctx = context.WithValue(ctx, "context-key-grpc-uri", CommonCmd_Ping_FullGRPCName)
		ctx = context.WithValue(ctx, "context-key-grpc-response-pointer", new(netutils.PingAck))
	}

	req := message.GetMessagePacket()
	req.Messages = message.Messages{&message.Message{Message: in, Uri: CommonCmd_Ping_FullMethodName}}

	req.Version = 1

	rsp, err := c.c.Call(ctx, req, opts...)

	message.PutMessagePacket(req)
	if err != nil {
		return nil, err
	}
	m0 := rsp.Messages[0]
	message.PutMessagePacket(rsp)

	if c.usingGRPC {
		if m0.Uri != c.urinetutilsPingAck {
			return nil, serror.NewText("return invalid type: %s,expect:%s", m0.Uri, c.urinetutilsPingAck)
		}
		return m0.Message.(*netutils.PingAck), nil
	}
	if m0.Uri == c.uriErrType {
		return nil, m0.Message.(error)
	}

	if m0.Uri != c.urinetutilsPingAck {
		return nil, serror.NewText("return invalid type: %s,expect:%s", m0.Uri, c.urinetutilsPingAck)
	}
	return m0.Message.(*netutils.PingAck), nil
}
